---
layout: page
title: Sample Projects
subtitle: Alta Planning and Design: Transportation and GIS Analyst
#use-site-title: true
---
        <script src="https://d3js.org/d3.v3.min.js"></script>
        <style>
        body {
            font: 10px sans-serif;
        }
        select {
            display: block;
        }
        .bar {
            fill: #4f7bc1;
            opacity: 0.8;
        }
        .line {
         fill: #c11717;
        }
        .axis path,
        .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }
        </style>

<h3> The Commute into Manhattan </h3>
<h5>The Majority of People Who Work In Manhattan Take Public Transit</h5>
<br>

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js" integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg==" crossorigin=""></script>


	<style>
		html, body {
			height: 100%;
			margin: 0;
		}
		#map {
			width: 600px;
			height: 400px;
		}
	</style>

	<style>#map { width: 99%; height: 500px; }
.info { padding: 6px 8px; font: 14px/16px Arial, Helvetica, sans-serif; background: white; background: rgba(255,255,255,0.8); box-shadow: 0 0 15px rgba(0,0,0,0.2); border-radius: 5px; } .info h4 { margin: 0 0 5px; color: #777; }
.legend { text-align: left; line-height: 18px; color: #555; } .legend i { width: 18px; height: 18px; float: left; margin-right: 8px; opacity: 0.7; }</style>



<div id='map'></div>

<script type="text/javascript" src='https://calvinbrown32.github.io/geojson/NYC/modeshareandtotal.js'></script>


<script>
	var map = L.map('map');
	
	map.createPane('labels');
	
	// This pane is above markers but below popups
	map.getPane('labels').style.zIndex = 650;
	
	
	
	
	// Layers in this pane are non-interactive and do not obscure mouse/touch events
	map.getPane('labels').style.pointerEvents = 'none';
	
	var cartodbAttribution = '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>';
	
	var positron = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png', {
		attribution: cartodbAttribution
	}).addTo(map);
	
	var positronLabels = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}.png', {
		attribution: cartodbAttribution,
		pane: 'labels'
	}).addTo(map);
	
	geojson = L.geoJson(commutedata).addTo(map);
	
	map.setView([40.751418432997454, -73.96047592163086], 7);
	
	
	
	// control that shows state info on hover
	var info = L.control();
	info.onAdd = function (map) {
		this._div = L.DomUtil.create('div', 'info');
		this.update();
		return this._div;
	};
	info.update = function (props) {
		this._div.innerHTML = '<h5>The Commute Into Manhattan</h5>' +  (props ?
			'In ' + '<b>' + props.name + ' County </b>' + props.sum + ' people commute into Manhattan.' + '<br />' + props.transitmodeshare.toFixed(0) + ' percent of them take public transit.' : 'Hover over a county');
		
		//'<b>' + props.name + '</b><br />' + props.density + ' people / mi<sup>2</sup>'
		//	: 'Hover over a state');
		
	};
	info.addTo(map);
	// get color depending on population density value
	function getColor(d) {
		return d > 80 ? '#045A8D' :
				d > 70  ? '#2B8CBE' :
				d > 60  ? '#74A9CF' :
				d > 50  ? '#A6BDDB' :
				d > 40  ? '#D0D1E6' :
				d > 0   ? '#F1EEF6' :
					   '#FFEDA0';
	}
	function style(feature) {
		return {
			weight: 1,
			opacity: 1,
			color: 'white',
			//dashArray: '3',
			fillOpacity: 0.8,
			fillColor: getColor(feature.properties.transitmodeshare)
		};
	}
	function highlightFeature(e) {
		var layer = e.target;
		layer.setStyle({
			weight: 2,
			color: '#666',
			//dashArray: '',
			fillOpacity: 0.8
		});
		if (!L.Browser.ie || !L.Browser.opera || !L.Browser.edge) {
			layer.bringToFront();
		}
		info.update(layer.feature.properties);
	}
	var geojson;
	function resetHighlight(e) {
		geojson.resetStyle(e.target);
		info.update();
	}
	function zoomToFeature(e) {
		map.fitBounds(e.target.getBounds());
	}
	function onEachFeature(feature, layer) {
		layer.on({
			mouseover: highlightFeature,
			mouseout: resetHighlight,
			click: zoomToFeature
		});
	}
	geojson = L.geoJson(commutedata, {
		style: style,
		onEachFeature: onEachFeature
	}).addTo(map);
	//map.attributionControl.addAttribution('Population data &copy; <a href="http://census.gov/">US Census Bureau</a>');
	var legend = L.control({position: 'bottomright'});
	legend.onAdd = function (map) {
		var div = L.DomUtil.create('div', 'info legend'),
			grades = [0, 40, 50, 60, 70, 80],
			labels = [],
			from, to;
		for (var i = 0; i < grades.length; i++) {
			from = grades[i];
			to = grades[i + 1];
			labels.push(
				'<i style="background:' + getColor(from + 1) + '"></i> ' +
				from + (to ? '&ndash;' + to : '+' + '   %'));
		}
		div.innerHTML = '<b>Percentage Of Commuters Who Take Transit</b>' + '<br>' + labels.join(' %' + '<br>');
		return div;
	};
	legend.addTo(map);
	
	map.setView([40.751418432997454, -73.96047592163086], 7);
</script>
	
<h6>I made this interactive map to visualize the number of people who commute into Manhattan and the percentage of those who take transit from each county in the region. To make the map, I worked with 2009 - 2013 CTPP commute flow <a href=https://www.census.gov/topics/employment/commuting/guidance/flows.html>data</a>, and used postgreSQL to create new columns containing the county level aggregate statistics, which are displayed when the mouse is hovered over a given county. I referenced and used code from a Leaflet interactive choropleth map <a href=https://leafletjs.com/examples/choropleth>tutorial</a>, customizing sections of code to suit my map. I also used labels-only map tiles created by Carto in conjunction with Leaflet's map pane and layer order functionality to overlay the labels above the data layer, improving the map's legibility.</h6> 

<br>
<br>


<h3>Mean Income of NJ Residents by Commute Mode</h3>
<br>
 <h6> Choose a county </h6>
        <div id='vis-container'></div>
        
        
        <script type="text/javascript">
            
            // Load data
             var fileName = "https://calvinbrown32.github.io/data/NJIncomeByMode.csv";
             var modeFields = ["Drive Alone","Carpool","Public Transportation","Walk","Taxicab, Motorcycle, Bicycle, or Other","Work at Home"];
            d3.csv(fileName, function(data) {
                var countyMap = {};
                var countyMapAverage = {};
               
                data.forEach(function(d) {
                    var County = d.County;
                    countyMap[County] = [];
                     countyMapAverage[County] = [];
                  
                   // Create Objects for each county: { CountyName: [ bar1Val, bar2Val, ... ] }
                   modeFields.forEach(function(field) {
                        countyMap[County].push( +d[field] );
                   });
                });
                makeVis(countyMap);
            });
            var makeVis = function(countyMap) {
                // Define dimensions of vis
                var margin = { top: 30, right: 50, bottom: 150, left: 50 },
                    width  = 600 - margin.left - margin.right,
                    height = 350 - margin.top  - margin.bottom;
                // Make x scale
                var xScale = d3.scale.ordinal()
                    .domain(modeFields)
                    .rangeRoundBands([0, 250], 0.7);
                // Make y scale, the domain will be defined on bar update
                var yScale = d3.scale.linear()
                       .domain([0,60000])
                    .range([170,0]);
                // Create canvas
                var canvas = d3.select("#vis-container")
                  .append("svg")
                    .attr("width",  width  + margin.left + margin.right)
                    .attr("height", height + margin.top  + margin.bottom)
                  .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
                // Make x-axis and add to canvas
                var xAxis = d3.svg.axis()
                    .scale(xScale)
                    .orient("bottom");
              
                canvas.append("g")
                    .attr("class", "x axis")
                    .attr("transform", "translate(0," + height + ")")
                    .call(xAxis)
                    .selectAll("text")
                    .attr("y", 5)
                    .attr("x",5)
                    .attr("dy", ".35em")
                    .attr("transform", "rotate(40)")
                    .style("text-anchor", "start");
                    
                // Make y-axis and add to canvas
                var yAxis = d3.svg.axis()
                    .scale(yScale)
                    .orient("left");
                    
                var yAxisHandleForUpdate = canvas.append("g")
                    .attr("class", "y axis")
                    .call(yAxis);
                   
                yAxisHandleForUpdate.append("text")
                   .attr("transform", "rotate(-90)")
                   .attr("y", 6)
                   .attr("dy", ".71em")
                   .style("text-anchor", "end")
                   .text("$ Annual Salary");
                var updateBars = function(data) {
             
                    var bars = canvas.selectAll(".bar").data(data);
                    var lines = canvas.selectAll(".line").data(data);
                  
                    // Add bars for new data
                    bars.enter()
                      .append("rect")
                        .attr("class", "bar")
                        .attr("x", function(d,i) { return xScale( modeFields[i] ); })
                        .attr("width", xScale.rangeBand())
                        .attr("y", function(d,i) { return yScale(d); })
                        .attr("height", function(d,i) { return height - yScale(d); });
                       
                    
                    // Update old bars
                    bars
                        .transition().duration(250)
                        .attr("y", function(d,i) { return yScale(d); })
                        .attr("height", function(d,i) { return height - yScale(d); });
                        
                    // Remove old bars
                    bars.exit().remove();
                    
                    
                    
                    // calculate mean income
                    var incomeaverage = 0;
                    for (var i = 0; i < data.length; i++) {
                    incomeaverage += data[i]/6
  }
                    //horizontal line for mean income
                       lines.enter()
                        .append("rect")
                        .attr("class", "line")
                        .attr("transform", "rotate(0)")
                        .attr("x",0)
                        .attr("y", function(d,i) { return yScale(incomeaverage); })
                        .attr("width", width/2)
                        .attr("height", .5)
                
                       lines
                        .transition().duration(250)
                        .attr("y", function(d,i) { return yScale(incomeaverage); })
                        .attr("height", .5);
                        
                    // Remove old ones
              		  lines.exit().remove();
                    
                    
                     var averageincometext = canvas.append("g")
                	
                   
                     averageincometext.append("text")
                    .attr("y", function(d) { return yScale(incomeaverage); })
                    .attr("x", 325)
                    .style("text-anchor", "end")
                    .text("mean income")
                    .attr("class", "line")  
                };
                // Handler for dropdown value change
                var dropdownChange = function() {
                    var newCounty = d3.select(this).property('value'),
                        newData   = countyMap[newCounty];
                    updateBars(newData);
                };
                // Get names of Counties, for dropdown
                var counties = Object.keys(countyMap).sort();
                var dropdown = d3.select("#vis-container")
                    .insert("select", "svg")
                    .on("change", dropdownChange);
                dropdown.selectAll("option")
                    .data(counties)
                  .enter().append("option")
                    .attr("value", function (d) { return d; })
                    .text(function (d) {
                        return d[0].toUpperCase() + d.slice(1,d.length); // capitalize 1st letter
                    });
                var initialData = countyMap[ counties[0] ];
                updateBars(initialData);
            };
        </script>

<h6>This interactive chart will be part of a dashboard that provides quick access to transportation mode share, demographics, and income data for commuters traveling into Manhattan's Central Business District (CBD). I am building the dashboard to offer easy access to important data and facts in the congestion pricing debate. My interactive chart, for example, helps refute claims that the congestion charge would be a regressive tax by showing that workers who drive have a significantly higher mean income than those taking transit. To make the chart I used 2017 American Community Survey 5 year annual income estimates. I used code from <a href=http://bl.ocks.org/williaster/10ef968ccfdc71c30ef8>this example</a> of an updating bar chart, customizing it for my data, and adding new code to include the horizontal mean income line. 
</h6> 


<center> <a href="https://calvinbrown32.github.io">home</a> </center>


